#!/bin/sh

set -eu

webmenu_args=''

if [ "$(puavo-conf puavo.localadmin.enabled)" = 'true' ]; then
  PUAVO_PERSONALLY_ADMINISTERED=true
  WM_CONFIG_JSON_PATH=/etc/webmenu/personally-administered-device/config.json
  export PUAVO_PERSONALLY_ADMINISTERED WM_CONFIG_JSON_PATH
else
  : # Do not set PUAVO_PERSONALLY_ADMINISTERED at all (to 0 or false),
    # webmenu/menu.yaml only checks if variable is set and not at its value.
fi

if [ "$(puavo-conf puavo.nonfree.ti_nspire_cx_cas.enabled)" = 'true' ]; then
  export PUAVO_TAG_TI_NSPIRE_CX_CAS=1
fi

if [ "$(puavo-conf puavo.webmenu.feedback.enabled)" = 'true' ]; then
  export WM_FEEDBACK_ACTIVE=true
fi

if [ "$(puavo-conf puavo.webmenu.webkiosk)" = 'true' ]; then
  webmenu_args="${webmenu_args} --webkiosk"
fi

exec webmenu $webmenu_args "$@"
