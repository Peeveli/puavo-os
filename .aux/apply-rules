#!/bin/sh

set -eu

# puppet/facter complains
# "Error: Facter: setmntent failed: No such file or directory (2): ..."
# without this.
test -e /etc/mtab || touch /etc/mtab

mkdir -p /var/log/puavo/puppet
env LC_CTYPE=en_US.UTF-8 puppet apply               \
    --detailed-exitcodes                            \
    --logdest console                               \
    --logdest /var/log/puavo/puppet/apply-rules.log \
    --modulepath rules                              \
    rules/site.pp \
  || [ $? -eq 2 ]
