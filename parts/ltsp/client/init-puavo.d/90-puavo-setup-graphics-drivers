puavo_graphics_driver=$(puavo-conf puavo.graphics.driver)

puavo_glx_alternative=/usr/lib/mesa-diverted
puavo_nvidia_alternative=

case "$puavo_graphics_driver" in
  nvidia)
    puavo_glx_alternative=/usr/lib/nvidia
    puavo_nvidia_alternative=current
    ;;
  nvidia-304)
    puavo_glx_alternative=/usr/lib/nvidia
    puavo_nvidia_alternative=legacy-304xx
    ;;
  nvidia-340)
    puavo_glx_alternative=/usr/lib/nvidia
    puavo_nvidia_alternative=legacy-340xx
    ;;
esac

update-alternatives --set glx "$puavo_glx_alternative"

if [ -n "$puavo_nvidia_alternative" ]; then
  if [ -d "/usr/lib/nvidia/${puavo_nvidia_alternative}" ]; then
    update-alternatives --set nvidia \
		        "/usr/lib/nvidia/${puavo_nvidia_alternative}"
  else
    update-alternatives --set nvidia /usr/lib/nvidia/current
  fi
fi
