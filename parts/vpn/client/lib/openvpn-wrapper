#!/bin/sh

set -eu

remote_host=$(puavo-conf puavo.vpn.client.remote_host)

/usr/sbin/openvpn                                         \
    --client                                              \
    --dev tap                                             \
    --proto tcp-client                                    \
    --ca /etc/puavo/certs/orgcabundle.pem                 \
    --cert /etc/puavo/certs/host.crt                      \
    --key /etc/puavo/certs/host.key                       \
    --ns-cert-type server                                 \
    --verb 3                                              \
    --keepalive 10 60                                     \
    --up-delay                                            \
    --script-security 2                                   \
    --route-up '/usr/lib/puavo-vpn-client/runme route-up' \
    --writepid /run/puavo/vpn-client-openvpn.pid          \
    --status /run/puavo/vpn-client-openvpn.status 10      \
    --remote "${remote_host}"
