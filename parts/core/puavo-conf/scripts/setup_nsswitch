#!/bin/sh

set -eu

# XXX get rid of hosttype handling
if [ "$(puavo-conf puavo.hosttype)" = 'laptop' ]; then
  nss_providers='sssd extrausers'
else
  nss_providers='extrausers'
fi

cat <<EOF > /etc/nsswitch.conf.tmp
passwd:         compat ${nss_providers}
group:          compat ${nss_providers}
shadow:         compat

hosts:          files dns
networks:       files

protocols:      db files
services:       db files
ethers:         db files
rpc:            db files

netgroup:       nis
EOF

mv /etc/nsswitch.conf.tmp /etc/nsswitch.conf

# Make sure that the nss-extrausers database files exist so that
# sssd (if used) does not go into offline mode when using extrausers proxy.
[ -e /var/lib/extrausers/group  ] || touch /var/lib/extrausers/group
[ -e /var/lib/extrausers/passwd ] || touch /var/lib/extrausers/passwd
