#!/bin/sh

set -eu

case "$(puavo-conf puavo.xsessions.default)" in
  puavo-abitti-usb-factory)
    session_manager='/usr/lib/puavo-ltsp-client/abitti-factory-session'

    abitti_home='/home/abitti'
    abitti_uid='997'
    abitti_user='abitti'

    useradd --system --create-home --home-dir "$abitti_home"          \
            --comment "Abitti USB Factory" --groups disk --user-group \
            --shell /bin/bash --uid "$abitti_uid" "$abitti_user"
    ;;

  puavo-infotv)
    session_manager='/usr/lib/puavo-ltsp-client/infotv-session'

    infotv_home='/home/puavo-infotv'
    infotv_uid='998'
    infotv_user='puavo-infotv'

    useradd --system --create-home --home-dir "$infotv_home"      \
            --comment Puavo-InfoTV --user-group --shell /bin/bash \
            --uid "$infotv_uid" "$infotv_user"
    ;;

  *)
    session_manager='/usr/bin/gnome-session'
    ;;
esac

ln -fns "$session_manager" /etc/alternatives/x-session-manager

exit 0
