#!/bin/sh

set -e

## Initramfs hook for Puavo devices.

MINKVER="2.6.17"
PREREQ=""

prereqs()
{
    echo "$PREREQ"
}

case "$1" in
    prereqs)
        prereqs
        exit 0
        ;;
esac


. /usr/share/initramfs-tools/hook-functions

manual_add_modules aufs
manual_add_modules overlay
manual_add_modules overlayfs
manual_add_modules squashfs

mkdir -p ${DESTDIR}/usr/bin/ ${DESTDIR}/usr/sbin/ ${DESTDIR}/usr/share/

copy_exec /usr/bin/lspci              /usr/bin
copy_exec /usr/bin/lsusb              /usr/bin
copy_exec /usr/bin/puavo-conf         /usr/bin
copy_exec /usr/sbin/dmidecode         /usr/sbin
copy_exec /usr/sbin/puavo-conf-update /usr/sbin

cp -a /usr/share/puavo-conf ${DESTDIR}/usr/share/

ln -s libpuavoconf.so.0 ${DESTDIR}/usr/lib/libpuavoconf.so
